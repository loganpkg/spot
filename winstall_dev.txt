:: < winstall_dev.txt cmd

:: Configuration
set install_dir=%HOMEDRIVE%%HOMEPATH%\bin
set flags=/Od /Zi /MT /Qspectre /Wall

set build_dir=%TEMP%\m4_spot_build

robocopy . %build_dir% /mir /a-:SH /xd ".git"
cd %build_dir% || exit 1
cl /c %flags% gen.c || exit 1
cl /c %flags% num.c || exit 1
cl /c %flags% buf.c || exit 1
cl /c %flags% eval.c || exit 1
cl /c %flags% ht.c || exit 1
cl /c %flags% gb.c || exit 1
cl /c %flags% m4.c || exit 1
cl /c %flags% spot.c || exit 1
cl /c %flags% bc.c || exit 1

cl %flags% m4.obj gen.obj num.obj buf.obj eval.obj ht.obj || exit 1
cl %flags% spot.obj gen.obj num.obj gb.obj || exit 1
cl %flags% bc.obj gen.obj num.obj buf.obj eval.obj || exit 1

copy /y *.exe %install_dir% || exit 1
